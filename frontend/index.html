<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wind & Thunderstorm Simulation</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
  body, html { margin:0; height:100%; display:flex; flex-direction: column; }
  #map { height:70%; }
  #info { height:30%; padding: 10px; background: #f0f0f0; font-family: sans-serif; }
  #info h2 { margin: 0 0 10px 0; }
  #info p { margin: 4px 0; font-size: 16px; }
</style>
</head>
<body>

<div id="map"></div>
<div id="info">
    <h2>Latest Prediction</h2>
    <p id="timestamp">Timestamp: --</p>
    <p id="wind">Wind Speed: -- km/h</p>
    <p id="thunder">Thunderstorm: --</p>
    <p id="prob">Thunder Probability: -- %</p>
</div>

<script>
const map = L.map('map').setView([23.0225, 72.5714], 11);

// Map tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Marker and storm circle
let predMarker = L.marker([23.0225, 72.5714]).addTo(map);
let stormCircle = L.circle([23.0225, 72.5714], { radius: 0, color: 'red', fillOpacity: 0.3 }).addTo(map);

// Fetch predictions from Flask
async function updatePrediction() {
    try {
        const res = await fetch('http://127.0.0.1:5000/predict');
        const data = await res.json();

        // Update marker & circle
        predMarker.setLatLng([23.0225, 72.5714]);
        stormCircle.setLatLng(predMarker.getLatLng());
        stormCircle.setRadius(data.thunder_prob * 5000); // scale probability

        // Animate marker slightly
        predMarker.setLatLng([
            23.0225 + 0.002*Math.sin(Date.now()/500),
            72.5714 + 0.002*Math.cos(Date.now()/500)
        ]);

        // Update info text
        document.getElementById('timestamp').innerText = `Timestamp: ${data.timestamp}`;
        document.getElementById('wind').innerText = `Wind Speed: ${data.wind_speed.toFixed(2)} km/h`;
        document.getElementById('thunder').innerText = `Thunderstorm: ${data.thunderstorm ? 'Yes' : 'No'}`;
        document.getElementById('prob').innerText = `Thunder Probability: ${(data.thunder_prob*100).toFixed(1)} %`;

    } catch (err) {
        console.error("Error fetching prediction:", err);
    }
}

// Start loop
updatePrediction();
setInterval(updatePrediction, 1000); // update every 1 sec
</script>

</body>
</html>
